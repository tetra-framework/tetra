(()=>{var o={init(){Alpine.magic("static",()=>o.$static)},$static(){return t=>window.__tetra_staticRoot+t},alpineComponentMixins(){return{init(){this.$dispatch("tetra:child-component-init",{component:this}),this.__initServerWatchers(),this.__initInner&&this.__initInner()},destroy(){this.$dispatch("tetra:child-component-destroy",{component:this}),this.__destroyInner&&this.__destroyInner()},_updateHtml(t){Alpine.morph(this.$root,t,{updating(e,n,r,a){if(n.hasAttribute&&n.hasAttribute("x-data-maintain")&&e.hasAttribute&&e.hasAttribute("x-data"))n.setAttribute("x-data",e.getAttribute("x-data")),n.removeAttribute("x-data-maintain");else if(n.hasAttribute&&n.hasAttribute("x-data-update")&&e.hasAttribute&&e.hasAttribute("x-data")){let i=o.jsonDecode(n.getAttribute("x-data-update")),s=o.jsonDecode(n.getAttribute("x-data-update-old")),c=window.Alpine.$data(e);for(let d in i)s.hasOwnProperty(d)&&s[d]!==c[d]||(c[d]=i[d]);n.setAttribute("x-data",e.getAttribute("x-data")),n.removeAttribute("x-data-update")}},lookahead:!0}),this.$dispatch("tetra:component-updated",{component:this})},_updateData(t){for(let e in t)this[e]=t[e];this.$dispatch("tetra:component-data-updated",{component:this})},_setValueByName(t,e){let n=document.getElementsByName(t);for(let r=0;r<n.length;r++)n[r].value=e},_removeComponent(){this.$dispatch("tetra:component-before-remove",{component:this}),this.$root.remove()},_replaceComponent(t){this.$dispatch("tetra:component-before-remove",{component:this}),this.$root.insertAdjacentHTML("afterend",t),this.$root.remove(),this.$dispatch("tetra:component-updated",{component:this})},_redirect(t){document.location=t},_dispatch(t,e){this.$dispatch(t,{_component:this,...e})},_pushUrl(t,e=!1){e?window.history.replaceState(null,"",t):window.history.pushState(null,"",t)},_uploadFile(t){let e=t.target.files[0],n="_upload_temp_file",r=this.__serverMethods.find(i=>i.name==="_upload_temp_file").endpoint,a=[t.target.name,t.target.files[0].name];o.callServerMethodWithFile(this,n,r,e,a).then(i=>{})},__initServerWatchers(){this.__serverMethods.forEach(t=>{t.watch&&t.watch.forEach(e=>{this.$watch(e,async(n,r)=>{await this[t.name](n,r,e)})})})},__childComponents:{},__rootBind:{"@tetra:child-component-init"(t){t.stopPropagation();let e=t.detail.component;e.key!==this.key&&(e.key&&(this.__childComponents[e.key]=e),e._parent=this)},"@tetra:child-component-destroy"(t){t.stopPropagation();let e=t.detail.component;e.key!==this.key&&(delete this.__childComponents[e.key],t.detail.component._parent=null)}}}},makeServerMethods(t){let e={};return t.forEach(n=>{var r=async function(...a){return await o.callServerMethod(this,n.name,n.endpoint,a)};n.debounce?r=o.debounce(r,n.debounce,n.debounce_immediate):n.throttle&&(r=o.throttle(r,n.throttle,{leading:n.throttle_leading,trailing:n.throttle_trailing})),e[n.name]=r}),e},makeAlpineComponent(t,e,n,r){Alpine.data(t,a=>{let{init:i,destroy:s,...c}=e,d=o.jsonDecode(a);return{componentName:t,__initInner:i,__destroyInner:s,__serverMethods:n,__serverProperties:r,...d||{},...c,...o.makeServerMethods(n),...o.alpineComponentMixins()}})},getStateWithChildren(t){let e={};t.__serverProperties.forEach(r=>{e[r]=t[r]});let n={state:t.__state,data:e,children:[]};for(let r in t.__childComponents){let a=t.__childComponents[r];n.children.push(o.getStateWithChildren(a))}return n},loadScript(t){return new Promise((e,n)=>{let r=document.createElement("script");r.src=t,r.onload=e,r.onerror=n,document.head.appendChild(r)})},loadStyles(t){return new Promise((e,n)=>{let r=document.createElement("link");r.href=t,r.rel="stylesheet",r.type="text/css",r.onload=e,r.onerror=n,document.head.appendChild(r)})},async handleServerMethodResponse(t,e){if(t.status===200){if(t.headers.get("T-Response")!=="true"){console.error("Response is not a Tetra response. Please check the server implementation.");return}let n=o.jsonDecode(await t.text());if(n.success){let r=[];return n.js.forEach(a=>{document.querySelector(`script[src="${CSS.escape(a)}"]`)||r.push(o.loadScript(a))}),n.styles.forEach(a=>{document.querySelector(`link[href="${CSS.escape(a)}"]`)||r.push(o.loadStyles(a))}),await Promise.all(r),n.callbacks&&n.callbacks.forEach(a=>{let i=e;a.callback.forEach((s,c)=>{c===a.callback.length-1?i[s](...a.args):(i=i[s],console.log(s,i))})}),n.result}else throw new Error("Error processing public method")}else throw new Error(`Server responded with an error ${t.status} (${t.statusText})`)},async callServerMethod(t,e,n,r){let a=o.getStateWithChildren(t);a.args=r;let i=await fetch(n,{method:"POST",headers:{"T-Request":"true","T-Current-URL":document.location.href,"Content-Type":"application/json","X-CSRFToken":window.__tetra_csrfToken},mode:"same-origin",body:o.jsonEncode(a)});return await this.handleServerMethodResponse(i,t)},async callServerMethodWithFile(t,e,n,r,a){let i=o.getStateWithChildren(t);i.args=a;let s=new FormData;s.append("file",r),s.append("state",o.jsonEncode(i));let c=await fetch(n,{method:"POST",headers:{"T-Request":"true","T-Current-URL":document.location.href,"X-CSRFToken":window.__tetra_csrfToken},mode:"same-origin",body:s});return await this.handleServerMethodResponse(c,t)},jsonReplacer(t,e){return e instanceof Date?{__type:"datetime",value:e.toISOString()}:e instanceof Set?{__type:"set",value:Array.from(e)}:e},jsonReviver(t,e){if(e&&typeof e=="object"&&e.__type){if(e.__type==="datetime")return new Date(e);if(e.__type==="set")return new Set(e)}return e},jsonEncode(t){return JSON.stringify(t,o.jsonReplacer)},jsonDecode(t){return JSON.parse(t,o.jsonReviver)},debounce(t,e,n){var r;return function(){var a=this,i=arguments,s=function(){r=null,n||t.apply(a,i)},c=n&&!r;clearTimeout(r),r=setTimeout(s,e),c&&t.apply(a,i)}},throttle(t,e,n){var r,a,i,s,c=0;n||(n={});var d=function(){c=n.leading===!1?0:now(),r=null,s=t.apply(a,i),r||(a=i=null)},l=function(){var h=new Date().getTime();!c&&n.leading===!1&&(c=h);var p=e-(h-c);return a=this,i=arguments,p<=0||p>e?(r&&(clearTimeout(r),r=null),c=h,s=t.apply(a,i),r||(a=i=null)):!r&&n.trailing!==!1&&(r=setTimeout(d,p)),s};return l.cancel=function(){clearTimeout(r),c=0,r=a=i=null},l}},u=o;window.Tetra=u;window.document.addEventListener("alpine:init",()=>{u.init()});})();
//# sourceMappingURL=tetra.min.js.map
