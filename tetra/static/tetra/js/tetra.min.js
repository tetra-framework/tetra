(()=>{var s={init(){Alpine.magic("static",()=>s.$static)},$static(){return t=>window.__tetra_staticRoot+t},alpineComponentMixins(){return{init(){this.$dispatch("tetra:child-component-init",{component:this}),this.__initServerWatchers(),this.__initInner&&this.__initInner()},destroy(){this.$dispatch("tetra:child-component-destroy",{component:this}),this.__destroyInner&&this.__destroyInner()},_updateHtml(t){Alpine.morph(this.$root,t,{updating(e,a,n,i){if(a.hasAttribute&&a.hasAttribute("x-data-maintain")&&e.hasAttribute&&e.hasAttribute("x-data"))a.setAttribute("x-data",e.getAttribute("x-data")),a.removeAttribute("x-data-maintain");else if(a.hasAttribute&&a.hasAttribute("x-data-update")&&e.hasAttribute&&e.hasAttribute("x-data")){let r=s.jsonDecode(a.getAttribute("x-data-update")),c=s.jsonDecode(a.getAttribute("x-data-update-old")),o=window.Alpine.$data(e);for(let d in r)c.hasOwnProperty(d)&&c[d]!==o[d]||(o[d]=r[d]);a.setAttribute("x-data",e.getAttribute("x-data")),a.removeAttribute("x-data-update")}},lookahead:!0}),this.$dispatch("tetra:component-updated",{component:this})},_updateData(t){for(let e in t)this[e]=t[e];this.$dispatch("tetra:component-data-updated",{component:this})},_setValueByName(t,e){let a=document.getElementsByName(t);for(let n=0;n<a.length;n++)a[n].value=e},_removeComponent(){this.$dispatch("tetra:component-before-remove",{component:this}),this.$root.remove()},_replaceComponent(t){this.$dispatch("tetra:component-before-remove",{component:this}),this.$root.insertAdjacentHTML("afterend",t),this.$root.remove(),this.$dispatch("tetra:component-updated",{component:this})},_redirect(t){document.location=t},_dispatch(t,e){this.$dispatch(t,{_component:this,...e})},_pushUrl(t,e=!1){e?window.history.replaceState(null,"",t):window.history.pushState(null,"",t)},__initServerWatchers(){this.__serverMethods.forEach(t=>{t.watch&&t.watch.forEach(e=>{this.$watch(e,async(a,n)=>{await this[t.name](a,n,e)})})})},__childComponents:{},__rootBind:{"@tetra:child-component-init"(t){t.stopPropagation();let e=t.detail.component;e.key!==this.key&&(e.key&&(this.__childComponents[e.key]=e),e._parent=this)},"@tetra:child-component-destroy"(t){t.stopPropagation();let e=t.detail.component;e.key!==this.key&&(delete this.__childComponents[e.key],t.detail.component._parent=null)}}}},makeServerMethods(t){let e={};return t.forEach(a=>{var n=async function(...i){return await s.callServerMethod(this,a.name,a.endpoint,i)};a.debounce?n=s.debounce(n,a.debounce,a.debounce_immediate):a.throttle&&(n=s.throttle(n,a.throttle,{leading:a.throttle_leading,trailing:a.throttle_trailing})),e[a.name]=n}),e},makeAlpineComponent(t,e,a,n){Alpine.data(t,i=>{let{init:r,destroy:c,...o}=e,d=s.jsonDecode(i);return{componentName:t,__initInner:r,__destroyInner:c,__serverMethods:a,__serverProperties:n,...d||{},...o,...s.makeServerMethods(a),...s.alpineComponentMixins()}})},getStateWithChildren(t){let e={};t.__serverProperties.forEach(n=>{e[n]=t[n]});let a={encrypted:t.__state,data:e,children:[]};for(let n in t.__childComponents){let i=t.__childComponents[n];a.children.push(s.getStateWithChildren(i))}return a},loadScript(t){return new Promise((e,a)=>{let n=document.createElement("script");n.src=t,n.onload=e,n.onerror=a,document.head.appendChild(n)})},loadStyles(t){return new Promise((e,a)=>{let n=document.createElement("link");n.href=t,n.rel="stylesheet",n.type="text/css",n.onload=e,n.onerror=a,document.head.appendChild(n)})},async handleServerMethodResponse(t,e){if(t.status===200){if(t.headers.get("T-Response")!=="true"){console.error("Response is not a Tetra response. Please check the server implementation.");return}let a=s.jsonDecode(t.headers.get("T-Messages"));a&&a.forEach((i,r)=>{e.$dispatch("tetra:newmessage",i)});let n=s.jsonDecode(await t.text());if(n.success){let i=[];return n.js.forEach(r=>{document.querySelector(`script[src="${CSS.escape(r)}"]`)||i.push(s.loadScript(r))}),n.styles.forEach(r=>{document.querySelector(`link[href="${CSS.escape(r)}"]`)||i.push(s.loadStyles(r))}),await Promise.all(i),n.callbacks&&n.callbacks.forEach(r=>{let c=e;r.callback.forEach((o,d)=>{d===r.callback.length-1?c[o](...r.args):(c=c[o],console.log(o,c))})}),n.result}else throw new Error("Error processing public method")}else throw new Error(`Server responded with an error ${t.status} (${t.statusText})`)},async callServerMethod(t,e,a,n){let i=s.getStateWithChildren(t);i.args=n||[];let r={method:"POST",headers:{"T-Request":"true","T-Current-URL":document.location.href,"X-CSRFToken":window.__tetra_csrfToken},mode:"same-origin"},c=new FormData,o=!1;for(let[l,h]of Object.entries(i.data))h instanceof File&&(o=!0,i.data[l]={},c.append(l,h));o?(c.append("component_state",s.jsonEncode(i)),r.body=c):(r.body=s.jsonEncode(i),r.headers["Content-Type"]="application/json");let d=await fetch(a,r);return await this.handleServerMethodResponse(d,t)},jsonReplacer(t,e){return e instanceof Date?{__type:"datetime",value:e.toISOString()}:e instanceof Set?{__type:"set",value:Array.from(e)}:e},jsonReviver(t,e){if(e&&typeof e=="object"&&e.__type){if(e.__type==="datetime")return new Date(e);if(e.__type==="set")return new Set(e)}return e},jsonEncode(t){return JSON.stringify(t,s.jsonReplacer)},jsonDecode(t){return JSON.parse(t,s.jsonReviver)},debounce(t,e,a){var n;return function(){var i=this,r=arguments,c=function(){n=null,a||t.apply(i,r)},o=a&&!n;clearTimeout(n),n=setTimeout(c,e),o&&t.apply(i,r)}},throttle(t,e,a){var n,i,r,c,o=0;a||(a={});var d=function(){o=a.leading===!1?0:now(),n=null,c=t.apply(i,r),n||(i=r=null)},l=function(){var h=new Date().getTime();!o&&a.leading===!1&&(o=h);var p=e-(h-o);return i=this,r=arguments,p<=0||p>e?(n&&(clearTimeout(n),n=null),o=h,c=t.apply(i,r),n||(i=r=null)):!n&&a.trailing!==!1&&(n=setTimeout(d,p)),c};return l.cancel=function(){clearTimeout(n),o=0,n=i=r=null},l}},u=s;window.Tetra=u;window.document.addEventListener("alpine:init",()=>{u.init()});})();
//# sourceMappingURL=tetra.min.js.map
