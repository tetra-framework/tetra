(()=>{var c={init(){Alpine.magic("static",()=>c.$static)},$static(){return t=>window.__tetra_staticRoot+t},alpineComponentMixins(){return{init(){this.$dispatch("tetra:child-component-init",{component:this}),this.__initServerWatchers(),this.__initInner&&this.__initInner(),document.addEventListener("tetra:before-request",t=>{let e=t.target.getAttribute("tx-indicator");e?this.$el.querySelectorAll(e).forEach(r=>r.classList.add("tetra-request")):t.target.classList.add("tetra-request")}),document.addEventListener("tetra:after-request",t=>{let e=t.target.getAttribute("tx-indicator");e?this.$el.querySelectorAll(e).forEach(r=>r.classList.remove("tetra-request")):t.target.classList.remove("tetra-request")})},destroy(){this.$dispatch("tetra:child-component-destroy",{component:this}),this.__destroyInner&&this.__destroyInner()},_updateHtml(t){Alpine.morph(this.$root,t,{updating(e,r,n,i){if(r.hasAttribute&&r.hasAttribute("x-data-maintain")&&e.hasAttribute&&e.hasAttribute("x-data"))r.setAttribute("x-data",e.getAttribute("x-data")),r.removeAttribute("x-data-maintain");else if(r.hasAttribute&&r.hasAttribute("x-data-update")&&e.hasAttribute&&e.hasAttribute("x-data")){let a=c.jsonDecode(r.getAttribute("x-data-update")),o=c.jsonDecode(r.getAttribute("x-data-update-old")),s=window.Alpine.$data(e);for(let d in a)o.hasOwnProperty(d)&&o[d]!==s[d]||(s[d]=a[d]);r.setAttribute("x-data",e.getAttribute("x-data")),r.removeAttribute("x-data-update")}},lookahead:!0}),this.$dispatch("tetra:component-updated",{component:this})},_updateData(t){for(let e in t)this[e]=t[e];this.$dispatch("tetra:component-data-updated",{component:this})},_setValueByName(t,e){let r=document.getElementsByName(t);for(let n=0;n<r.length;n++)r[n].value=e},_removeComponent(){this.$dispatch("tetra:component-before-remove",{component:this}),this.$root.remove()},_replaceComponent(t){this.$dispatch("tetra:component-before-remove",{component:this}),this.$root.insertAdjacentHTML("afterend",t),this.$root.remove(),this.$dispatch("tetra:component-updated",{component:this})},_redirect(t){document.location=t},_dispatch(t,e){this.$dispatch(t,{_component:this,...e})},_pushUrl(t,e=!1){e?window.history.replaceState(null,"",t):window.history.pushState(null,"",t)},_updateSearchParam(t,e){let r=new URL(window.location);e?r.searchParams.set(t,e):r.searchParams.delete(t),window.history.pushState(null,"",r.toString())},__initServerWatchers(){this.__serverMethods.forEach(t=>{t.watch&&t.watch.forEach(e=>{this.$watch(e,async(r,n)=>{await this[t.name](r,n,e)})})})},__childComponents:{},__rootBind:{"@tetra:child-component-init"(t){t.stopPropagation();let e=t.detail.component;e.key!==this.key&&(e.key&&(this.__childComponents[e.key]=e),e._parent=this)},"@tetra:child-component-destroy"(t){t.stopPropagation();let e=t.detail.component;e.key!==this.key&&(delete this.__childComponents[e.key],t.detail.component._parent=null)}}}},makeServerMethods(t){let e={};return t.forEach(r=>{var n=async function(...i){return await c.callServerMethod(this,r.name,r.endpoint,i)};r.debounce?n=c.debounce(n,r.debounce,r.debounce_immediate):r.throttle&&(n=c.throttle(n,r.throttle,{leading:r.throttle_leading,trailing:r.throttle_trailing})),e[r.name]=n}),e},makeAlpineComponent(t,e,r,n){Alpine.data(t,i=>{let{init:a,destroy:o,...s}=e,d=c.jsonDecode(i);return{componentName:t,__initInner:a,__destroyInner:o,__serverMethods:r,__serverProperties:n,...d||{},...s,...c.makeServerMethods(r),...c.alpineComponentMixins()}})},getStateWithChildren(t){let e={};t.__serverProperties.forEach(n=>{e[n]=t[n]});let r={encrypted:t.__state,data:e,children:[]};for(let n in t.__childComponents){let i=t.__childComponents[n];r.children.push(c.getStateWithChildren(i))}return r},loadScript(t){return new Promise((e,r)=>{let n=document.createElement("script");n.src=t,n.onload=e,n.onerror=r,document.head.appendChild(n)})},loadStyles(t){return new Promise((e,r)=>{let n=document.createElement("link");n.href=t,n.rel="stylesheet",n.type="text/css",n.onload=e,n.onerror=r,document.head.appendChild(n)})},getFilenameFromContentDisposition(t){if(!t)return null;let e=/filename\*=([^']*)'([^']*)'([^;]*)/i.exec(t);if(e)try{return decodeURIComponent(e[3])}catch(r){console.warn("Error decoding filename:",r)}return e=/filename=["']?([^"';\n]*)["']?/i.exec(t),e?e[1]:null},async handleServerMethodResponse(t,e){if(t.status===200){if(t.headers.get("T-Response")!=="true")throw new Error("Response is not a Tetra response. Please check the server implementation.");let r=c.jsonDecode(t.headers.get("T-Messages"));r&&r.forEach((a,o)=>{e.$dispatch("tetra:new-message",a)});let n=t.headers.get("Content-Disposition");if(n!=null&&n.startsWith("attachment")){let a=document.createElement("a");a.href=URL.createObjectURL(await t.blob()),a.download=this.getFilenameFromContentDisposition(n),a.click(),a.remove();return}let i=c.jsonDecode(await t.text());if(i.success){let a=[];return i.js.forEach(o=>{document.querySelector(`script[src="${CSS.escape(o)}"]`)||a.push(c.loadScript(o))}),i.styles.forEach(o=>{document.querySelector(`link[href="${CSS.escape(o)}"]`)||a.push(c.loadStyles(o))}),await Promise.all(a),i.callbacks&&i.callbacks.forEach(o=>{let s=e;o.callback.forEach((d,l)=>{l===o.callback.length-1?s[d](...o.args):(s=s[d],console.log(d,s))})}),i.result}else throw new Error("Error processing public method")}else throw new Error(`Server responded with an error ${t.status} (${t.statusText})`)},async callServerMethod(t,e,r,n){let i=c.getStateWithChildren(t);i.args=n||[];let a={method:"POST",headers:{"T-Request":"true","T-Current-URL":document.location.href,"X-CSRFToken":window.__tetra_csrfToken},mode:"same-origin"},o=new FormData,s=!1;for(let[l,h]of Object.entries(i.data))h instanceof File&&(s=!0,i.data[l]={},o.append(l,h));s?(o.append("component_state",c.jsonEncode(i)),a.body=o):(a.body=c.jsonEncode(i),a.headers["Content-Type"]="application/json"),t.$dispatch("tetra:before-request",{component:this});let d=await fetch(r,a);return t.$dispatch("tetra:after-request",{component:this}),await this.handleServerMethodResponse(d,t)},jsonReplacer(t,e){return e instanceof Date?{__type:"datetime",value:e.toISOString()}:e instanceof Set?{__type:"set",value:Array.from(e)}:e},jsonReviver(t,e){if(e&&typeof e=="object"&&e.__type){if(e.__type==="datetime")return new Date(e);if(e.__type==="set")return new Set(e)}return e},jsonEncode(t){return JSON.stringify(t,c.jsonReplacer)},jsonDecode(t){return JSON.parse(t,c.jsonReviver)},debounce(t,e,r){var n;return function(){var i=this,a=arguments,o=function(){n=null,r||t.apply(i,a)},s=r&&!n;clearTimeout(n),n=setTimeout(o,e),s&&t.apply(i,a)}},throttle(t,e,r){var n,i,a,o,s=0;r||(r={});var d=function(){s=r.leading===!1?0:now(),n=null,o=t.apply(i,a),n||(i=a=null)},l=function(){var h=new Date().getTime();!s&&r.leading===!1&&(s=h);var u=e-(h-s);return i=this,a=arguments,u<=0||u>e?(n&&(clearTimeout(n),n=null),s=h,o=t.apply(i,a),n||(i=a=null)):!n&&r.trailing!==!1&&(n=setTimeout(d,u)),o};return l.cancel=function(){clearTimeout(n),s=0,n=i=a=null},l}},p=c;window.Tetra=p;window.document.addEventListener("alpine:init",()=>{p.init()});})();
//# sourceMappingURL=tetra.min.js.map
